hosts:
  sut-host: ${{SUT_SERVER}}
  driver-host: ${{LOAD_DRIVER_SERVER}}

roles:
  sut:
    hosts:
      - sut-host
    setup-scripts:
      - setup-sut
    run-scripts:
      - run-pidstat
      - run-vmstat
      - run-mpstat
      - run-pmap
      - run-strace
      - run-perfstat
    cleanup-scripts:
      - export-results
      - cleanup-sut
      - cleanup-profiling

  load:
    hosts:
      - driver-host
    setup-scripts:
      - setup-driver
    run-scripts:
      - run-benchmark
    cleanup-scripts:
      - parse-metrics
      - cleanup-driver

states:
  SUT_SERVER: LOCAL
  LOAD_DRIVER_SERVER: LOCAL

  # overall duration of the test in seconds
  TARGET_PROTOCOL: http
  TARGET_HOST: localhost
  TARGET_PORT: 8080
  TARGET_ENDPOINT: time/cached

  RATE: 100
  DURATION: 40
  VUS: 10
  # configurable only with HF
  CONNECTIONS: ${{VUS}}